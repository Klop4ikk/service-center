{% extends "layout.html" %}

{% block title %}Редактирование заявки #{{ request.id }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-edit"></i> Редактирование заявки #{{ request.id }}</h1>
    <a href="{{ url_for('request_detail', request_id=request.id) }}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Назад к заявке
    </a>
</div>

<div class="form-container">
    <form method="POST" class="request-form">
        <div class="form-section">
            <h3><i class="fas fa-info-circle"></i> Основная информация</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="home_tech_type">
                        <i class="fas fa-tv"></i> Вид бытовой техники *
                    </label>
                    <input type="text" 
                           id="home_tech_type" 
                           name="home_tech_type" 
                           value="{{ request.home_tech_type }}" 
                           required>
                </div>
                
                <div class="form-group">
                    <label for="home_tech_model">
                        <i class="fas fa-barcode"></i> Модель техники *
                    </label>
                    <input type="text" 
                           id="home_tech_model" 
                           name="home_tech_model" 
                           value="{{ request.home_tech_model }}" 
                           required>
                </div>
            </div>
            
            <div class="form-group">
                <label for="problem_description">
                    <i class="fas fa-exclamation-triangle"></i> Описание проблемы *
                </label>
                <textarea id="problem_description" 
                          name="problem_description" 
                          rows="4" 
                          required>{{ request.problem_description }}</textarea>
            </div>
        </div>
        
        <div class="form-section">
            <h3><i class="fas fa-cogs"></i> Управление заявкой</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="request_status">
                        <i class="fas fa-tasks"></i> Статус заявки *
                    </label>
                    <select id="request_status" name="request_status" required>
                        <option value="Новая заявка" {% if request.request_status == 'Новая заявка' %}selected{% endif %}>
                            Новая заявка
                        </option>
                        <option value="В процессе ремонта" {% if request.request_status == 'В процессе ремонта' %}selected{% endif %}>
                            В процессе ремонта
                        </option>
                        <option value="Ожидание запчастей" {% if request.request_status == 'Ожидание запчастей' %}selected{% endif %}>
                            Ожидание запчастей
                        </option>
                        <option value="Готова к выдаче" {% if request.request_status == 'Готова к выдаче' %}selected{% endif %}>
                            Готова к выдаче
                        </option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="master_id">
                        <i class="fas fa-user-cog"></i> Назначить мастера
                    </label>
                    <select id="master_id" name="master_id">
                        <option value="">-- Не назначен --</option>
                        {% for master in masters %}
                        <option value="{{ master.id }}" 
                                {% if request.master_id == master.id %}selected{% endif %}>
                            {{ master.fio }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="repair_parts">
                    <i class="fas fa-cogs"></i> Запчасти / материалы
                </label>
                <textarea id="repair_parts" 
                          name="repair_parts" 
                          rows="2">{{ request.repair_parts or '' }}</textarea>
                <small class="form-text">Укажите использованные или необходимые запчасти</small>
            </div>
            
            {% if g.user.type in ['Оператор', 'admin', 'Менеджер'] %}
            <div class="form-group">
                <label for="client_id">
                    <i class="fas fa-user"></i> Клиент
                </label>
                <select id="client_id" name="client_id" required>
                    {% for client in clients %}
                    <option value="{{ client.id }}" 
                            {% if request.client_id == client.id %}selected{% endif %}>
                        {{ client.fio }} ({{ client.phone }})
                    </option>
                    {% endfor %}
                </select>
            </div>
            {% endif %}
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-save"></i> Сохранить изменения
            </button>
            
            <button type="reset" class="btn btn-secondary">
                <i class="fas fa-undo"></i> Сбросить
            </button>
            
            <a href="{{ url_for('request_detail', request_id=request.id) }}" class="btn btn-outline">
                <i class="fas fa-times"></i> Отмена
            </a>
        </div>
    </form>
</div>

<style>
.form-container {
    max-width: 800px;
    margin: 0 auto;
    background: white;
    border-radius: 10px;
    padding: 2rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.form-section {
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid #eee;
}

.form-section:last-child {
    border-bottom: none;
}

.form-section h3 {
    margin-top: 0;
    margin-bottom: 1.5rem;
    color: #4b6cb7;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #495057;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.form-group input,
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ced4da;
    border-radius: 5px;
    font-size: 1rem;
    transition: all 0.3s;
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
    outline: none;
    border-color: #4b6cb7;
    box-shadow: 0 0 0 3px rgba(75, 108, 183, 0.1);
}

.form-group textarea {
    min-height: 100px;
    resize: vertical;
}

.form-text {
    display: block;
    margin-top: 0.25rem;
    color: #6c757d;
    font-size: 0.875rem;
}

.form-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid #eee;
}

.btn-lg {
    padding: 0.75rem 1.5rem;
    font-size: 1.1rem;
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .btn {
        width: 100%;
    }
}
</style>
{% endblock %}